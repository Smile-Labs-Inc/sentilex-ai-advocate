<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CERT Technical Report - {{ incident.title }}</title>
    <style>
      @page {
        size: A4;
        margin: 2cm;
        @top-center {
          content: "Sri Lanka CERT - Technical Report";
          font-size: 10pt;
          color: #666;
        }
        @bottom-center {
          content: "Page " counter(page) " of " counter(pages);
          font-size: 9pt;
          color: #666;
        }
      }

      body {
        font-family: Arial, Helvetica, sans-serif;
        font-size: 11pt;
        line-height: 1.5;
        color: #000;
      }

      .header {
        text-align: center;
        margin-bottom: 30px;
        border-bottom: 3px solid #003d7a;
        padding-bottom: 15px;
      }

      .header h1 {
        margin: 0;
        font-size: 20pt;
        font-weight: bold;
        color: #003d7a;
      }

      .header .subtitle {
        font-size: 12pt;
        color: #666;
        margin-top: 5px;
      }

      .section {
        margin-bottom: 25px;
        page-break-inside: avoid;
      }

      .section-title {
        font-size: 14pt;
        font-weight: bold;
        background-color: #f0f0f0;
        padding: 8px;
        border-left: 4px solid #003d7a;
        margin-bottom: 10px;
      }

      .subsection-title {
        font-size: 12pt;
        font-weight: bold;
        margin-top: 15px;
        margin-bottom: 8px;
        color: #003d7a;
      }

      .field {
        margin-bottom: 8px;
      }

      .field-label {
        font-weight: bold;
        display: inline-block;
        width: 200px;
      }

      .field-value {
        display: inline;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
        font-size: 10pt;
      }

      th,
      td {
        border: 1px solid #666;
        padding: 8px;
        text-align: left;
      }

      th {
        background-color: #003d7a;
        color: white;
        font-weight: bold;
      }

      .severity-high {
        color: #d32f2f;
        font-weight: bold;
      }

      .severity-medium {
        color: #f57c00;
        font-weight: bold;
      }

      .severity-low {
        color: #388e3c;
        font-weight: bold;
      }

      .code-block {
        background-color: #f5f5f5;
        border: 1px solid #ddd;
        padding: 10px;
        font-family: "Courier New", monospace;
        font-size: 9pt;
        white-space: pre-wrap;
        margin: 10px 0;
      }

      .alert-box {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 10px;
        margin: 10px 0;
      }

      .footer {
        margin-top: 50px;
        font-size: 9pt;
        color: #666;
        text-align: center;
        border-top: 1px solid #ddd;
        padding-top: 15px;
      }
    </style>
  </head>
  <body>
    <div class="header">
      <h1>TECHNICAL INCIDENT REPORT</h1>
      <div class="subtitle">
        Sri Lanka Computer Emergency Readiness Team (CERT)
      </div>
      <div class="subtitle">Cybercrime Technical Analysis</div>
    </div>

    <div class="section">
      <div class="section-title">Executive Summary</div>
      <div class="field">
        <span class="field-label">Report ID:</span>
        <span class="field-value"
          >CERT-{{ incident.id }}-{{ now.strftime('%Y%m%d') }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Report Date:</span>
        <span class="field-value"
          >{{ now.strftime('%d %B %Y, %I:%M %p') }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Incident Classification:</span>
        <span class="field-value"
          >{{ incident.incident_type|replace('_', ' ')|title }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Severity Level:</span>
        <span class="field-value severity-high">HIGH</span>
      </div>
      <p style="margin-top: 15px">
        This report provides a technical analysis of a cybercrime incident
        reported to the Sri Lanka CERT. The incident involves {{
        incident.incident_type|replace('_', ' ') }} and has been classified for
        investigation and potential legal action.
      </p>
    </div>

    <div class="section">
      <div class="section-title">Incident Classification</div>
      <div class="field">
        <span class="field-label">Primary Category:</span>
        <span class="field-value"
          >{{ incident.incident_type|replace('_', ' ')|title }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Incident Title:</span>
        <span class="field-value">{{ incident.title }}</span>
      </div>
      <div class="field">
        <span class="field-label">Date of Occurrence:</span>
        <span class="field-value"
          >{{ incident.date_occurred or 'Not specified' }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Report Filed:</span>
        <span class="field-value"
          >{{ incident.created_at.strftime('%d %B %Y') }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Status:</span>
        <span class="field-value">{{ incident.status|upper }}</span>
      </div>
    </div>

    <div class="section">
      <div class="section-title">Technical Details</div>

      <div class="subsection-title">Platforms and Services Involved</div>
      <div class="field">
        <span class="field-label">Platforms:</span>
        <span class="field-value"
          >{{ incident.platforms_involved or 'Not specified' }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Jurisdiction:</span>
        <span class="field-value"
          >{{ incident.jurisdiction or 'Not specified' }}</span
        >
      </div>
      <div class="field">
        <span class="field-label">Location:</span>
        <span class="field-value"
          >{{ incident.location or 'Not specified' }}</span
        >
      </div>

      <div class="subsection-title">Incident Description</div>
      <p>{{ incident.description }}</p>

      {% if incident.perpetrator_info %}
      <div class="subsection-title">Perpetrator Information</div>
      <div class="code-block">{{ incident.perpetrator_info }}</div>
      {% endif %}
    </div>

    {% if evidence_list %}
    <div class="section">
      <div class="section-title">Digital Evidence Analysis</div>
      <p>
        The following digital evidence has been collected and preserved for
        forensic analysis:
      </p>
      <table>
        <thead>
          <tr>
            <th>Evidence ID</th>
            <th>File Name</th>
            <th>Type</th>
            <th>Size (KB)</th>
            <th>Collection Date</th>
            <th>Hash (MD5)</th>
          </tr>
        </thead>
        <tbody>
          {% for evidence in evidence_list %}
          <tr>
            <td>EV-{{ evidence.id }}</td>
            <td>{{ evidence.file_name }}</td>
            <td>{{ evidence.file_type or 'Unknown' }}</td>
            <td>
              {{ (evidence.file_size / 1024)|round(2) if evidence.file_size else
              'N/A' }}
            </td>
            <td>{{ evidence.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</td>
            <td style="font-family: monospace; font-size: 8pt">
              {{ evidence.file_hash or 'Pending' }}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="alert-box">
        <strong>Chain of Custody:</strong> All evidence files have been securely
        stored with cryptographic hashing to ensure integrity. Total evidence
        items: {{ evidence_list|length }}
      </div>
    </div>
    {% endif %} {% if occurrences %}
    <div class="section">
      <div class="section-title">Incident Timeline</div>
      <p>Chronological sequence of events as reported:</p>
      <table>
        <thead>
          <tr>
            <th>Date/Time</th>
            <th>Event</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          {% for occurrence in occurrences %}
          <tr>
            <td>{{ occurrence.date_occurred }}</td>
            <td>{{ occurrence.title }}</td>
            <td>{{ occurrence.description }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}

    <div class="section">
      <div class="section-title">Impact Assessment</div>
      <div class="subsection-title">Victim Impact</div>
      <ul>
        <li>
          <strong>Emotional/Psychological:</strong> Potential trauma and
          distress from cybercrime incident
        </li>
        <li>
          <strong>Privacy:</strong> Possible breach of personal information and
          privacy
        </li>
        <li>
          <strong>Financial:</strong> Potential financial losses or fraud (if
          applicable)
        </li>
        <li><strong>Reputational:</strong> Risk of reputational damage</li>
      </ul>

      <div class="subsection-title">Technical Impact</div>
      <ul>
        <li>Digital evidence collected and preserved</li>
        <li>Platform-specific investigation required</li>
        <li>Potential for cross-border coordination</li>
      </ul>
    </div>

    <div class="section">
      <div class="section-title">Recommendations</div>
      <div class="subsection-title">Immediate Actions</div>
      <ol>
        <li>Preserve all digital evidence with proper chain of custody</li>
        <li>Contact platform providers for data preservation requests</li>
        <li>Coordinate with relevant law enforcement agencies</li>
        <li>Document all communication and evidence collection</li>
      </ol>

      <div class="subsection-title">Investigation Steps</div>
      <ol>
        <li>Conduct forensic analysis of collected digital evidence</li>
        <li>Identify and verify perpetrator information</li>
        <li>Determine jurisdiction and applicable laws</li>
        <li>Prepare case for legal proceedings</li>
      </ol>

      <div class="subsection-title">Victim Support</div>
      <ol>
        <li>Provide resources for psychological support</li>
        <li>Guide through legal process and options</li>
        <li>Assist with platform reporting and account security</li>
        <li>Monitor for ongoing threats or harassment</li>
      </ol>
    </div>

    <div class="section">
      <div class="section-title">Conclusion</div>
      <p>
        This incident represents a serious cybercrime matter requiring immediate
        attention and investigation. The evidence collected demonstrates {{
        incident.incident_type|replace('_', ' ') }} activity that may violate
        Sri Lankan cybercrime laws. CERT recommends immediate law enforcement
        involvement and comprehensive digital forensic analysis.
      </p>
      <p>
        All evidence has been properly documented and preserved for legal
        proceedings. This report should be used in conjunction with the formal
        police statement for comprehensive case documentation.
      </p>
    </div>

    <div class="footer">
      <p><strong>Sri Lanka Computer Emergency Readiness Team (CERT)</strong></p>
      <p>
        This is a confidential technical report generated for law enforcement
        purposes
      </p>
      <p>Report Generated: {{ now.strftime('%d %B %Y at %I:%M %p') }}</p>
      <p>For inquiries: cert@icta.lk | +94 11 2369099</p>
    </div>
  </body>
</html>
