# Sentilex AI Advocate - Technical Audit & Completion Roadmap

**Document Version:** 1.0  
**Last Updated:** 2026-02-08  
**Status:** In Development

---

## ğŸ“‹ Table of Contents

1. [System Inventory & Status](#system-inventory--status)
2. [Frontend-Backend API Mapping](#frontend-backend-api-mapping)
3. [Missing Handshake List](#missing-handshake-list)
4. [Full User Walkthrough](#full-user-walkthrough)
5. [Final Completion Checklist](#final-completion-checklist)

---

## ğŸ” System Inventory & Status

### Frontend Pages Overview

| Page                   | Route                 | Current State           | Backend Integration                 | Notes                                                  |
| ---------------------- | --------------------- | ----------------------- | ----------------------------------- | ------------------------------------------------------ |
| **Auth**               | `/` (default)         | âœ… Fully Integrated     | `/auth/*`                           | Login, Register, OAuth working                         |
| **Dashboard**          | `/dashboard`          | âš ï¸ Partially Integrated | `/incidents/`, `/api/chat/stats`    | Static UI with mock data, needs real incident fetching |
| **New Incident**       | `/new-incident`       | âœ… Fully Integrated     | `/incidents/`                       | Wizard creates incident via API                        |
| **Incident Workspace** | `/incident-workspace` | âœ… Fully Integrated     | `/incidents/{id}/*`                 | Chat, evidence upload, incident creation working       |
| **Incident Detail**    | `/incident-detail`    | âš ï¸ Static UI Only       | `/incidents/{id}`                   | No API calls implemented                               |
| **Lawyer Finder**      | `/lawyers`            | âœ… Fully Integrated     | `/lawyers/`                         | Search and list functionality working                  |
| **Evidence Vault**     | `/evidence`           | âœ… Fully Integrated     | `/evidence/*`                       | Filtering, deletion, global view working               |
| **Lawbook**            | `/lawbook`            | âœ… Fully Integrated     | `/lawbook/*`                        | Query, laws list, content fetch working                |
| **AI Chat**            | `/ai-chat`            | âš ï¸ Partially Integrated | `/api/chat/*`                       | UI ready, needs session management                     |
| **Settings**           | `/settings`           | âš ï¸ Partially Integrated | `/auth/me`, `/auth/change-password` | Profile update needs full implementation               |
| **Verify Email**       | `/verify-email`       | âœ… Fully Integrated     | `/auth/verify-email`                | Email verification working                             |

### Legend

- âœ… **Fully Integrated**: Page has complete backend communication
- âš ï¸ **Partially Integrated**: Some features work, others need backend connection
- âŒ **Static UI Only**: No backend integration yet

---

## ğŸ”— Frontend-Backend API Mapping

### Authentication System

#### Frontend Service: `services/auth.ts`

| Frontend Method       | Backend Endpoint        | HTTP Method | Status     | Data Schema                                |
| --------------------- | ----------------------- | ----------- | ---------- | ------------------------------------------ |
| `register()`          | `/auth/register`        | POST        | âœ… Working | `RegisterRequest` â†’ `RegistrationResponse` |
| `login()`             | `/auth/login`           | POST        | âœ… Working | `LoginRequest` â†’ `LoginResponse`           |
| `logout()`            | `/auth/logout`          | POST        | âœ… Working | Bearer token required                      |
| `refreshToken()`      | `/auth/refresh`         | POST        | âœ… Working | `{refresh_token}` â†’ `{access_token}`       |
| `getCurrentUser()`    | `/auth/me`              | GET         | âœ… Working | Returns `UserProfile`                      |
| `updateProfile()`     | `/auth/me`              | PATCH       | âœ… Working | `Partial<UserProfile>`                     |
| `verifyEmail()`       | `/auth/verify-email`    | POST        | âœ… Working | `{token}`                                  |
| `changePassword()`    | `/auth/change-password` | POST        | âœ… Working | `{current_password, new_password}`         |
| `setupMFA()`          | `/auth/mfa/setup`       | POST        | âœ… Working | Returns QR code & backup codes             |
| `enableMFA()`         | `/auth/mfa/enable`      | POST        | âœ… Working | `{code}`                                   |
| `getActiveSessions()` | `/auth/sessions`        | GET         | âœ… Working | Returns session list                       |
| `revokeSession()`     | `/auth/sessions/{id}`   | DELETE      | âœ… Working | Session ID required                        |

**Environment Variables Required:**

- `VITE_API_URL` (default: `http://127.0.0.1:8000`)
- JWT stored in: `localStorage.sentilex_auth_token`

---

### Incident Management System

#### Frontend Service: `services/incident.ts`

| Frontend Method             | Backend Endpoint                        | HTTP Method | Status     | Data Schema                                  |
| --------------------------- | --------------------------------------- | ----------- | ---------- | -------------------------------------------- |
| `createIncident()`          | `/incidents/`                           | POST        | âœ… Working | `IncidentCreate` â†’ `IncidentResponse`        |
| `getIncidents()`            | `/incidents/`                           | GET         | âœ… Working | Query param: `status_filter`                 |
| `getIncident()`             | `/incidents/{id}`                       | GET         | âœ… Working | Returns `IncidentResponse`                   |
| `sendIncidentChatMessage()` | `/incidents/{id}/messages`              | POST        | âœ… Working | `{content}` â†’ `IncidentChatExchangeResponse` |
| `getIncidentChatMessages()` | `/incidents/{id}/messages`              | GET         | âœ… Working | Returns message array                        |
| `uploadEvidence()`          | `/incidents/{id}/evidence`              | POST        | âœ… Working | FormData with files                          |
| `getIncidentEvidence()`     | `/incidents/{id}/evidence`              | GET         | âœ… Working | Returns evidence list                        |
| `deleteEvidence()`          | `/incidents/{id}/evidence/{evidenceId}` | DELETE      | âœ… Working | -                                            |

**Backend Routes:** `routers/incidents.py`

**Missing Endpoints:**

- âŒ `PATCH /incidents/{id}` - Update incident (exists in backend, not used in frontend)
- âŒ `DELETE /incidents/{id}` - Delete incident (exists in backend, not used in frontend)

---

### Evidence Management System (Global)

#### Frontend Service: `services/evidence.ts`

| Frontend Method  | Backend Endpoint | HTTP Method | Status     | Data Schema                                    |
| ---------------- | ---------------- | ----------- | ---------- | ---------------------------------------------- |
| `getAllEvidence` | `/evidence/`     | GET         | âœ… Working | Query params: filters â†’ `EvidenceListResponse` |
| `getEvidence`    | `/evidence/{id}` | GET         | âœ… Working | Returns `EvidenceResponse`                     |
| `deleteEvidence` | `/evidence/{id}` | DELETE      | âœ… Working | -                                              |

**Backend Routes:** `routers/evidence.py`

---

### Document Generation System

#### Frontend Service: `services/documents.ts`

| Frontend Method          | Backend Endpoint                                     | HTTP Method | Status     | Return Type |
| ------------------------ | ---------------------------------------------------- | ----------- | ---------- | ----------- |
| `exportPoliceStatement`  | `/documents/incidents/{id}/export/police-statement`  | GET         | âœ… Working | Blob (PDF)  |
| `exportCERTReport`       | `/documents/incidents/{id}/export/cert-report`       | GET         | âœ… Working | Blob (PDF)  |
| `exportEvidenceManifest` | `/documents/incidents/{id}/export/evidence-manifest` | GET         | âœ… Working | Blob (PDF)  |
| `exportCaseFile`         | `/documents/incidents/{id}/export/case-file`         | GET         | âœ… Working | Blob (ZIP)  |

**Backend Routes:** `routers/documents.py`

---

### Lawyer Management System

#### Frontend Service: `services/lawyers.tsx`

| Frontend Method    | Backend Endpoint           | HTTP Method | Status     | Data Schema                                  |
| ------------------ | -------------------------- | ----------- | ---------- | -------------------------------------------- |
| `searchLawyers()`  | `/lawyers/`                | GET         | âœ… Working | Query params: `district`, `specialty`        |
| `register()`       | `/lawyers/register`        | POST        | âœ… Working | `LawyerRegisterRequest`                      |
| `login()`          | `/lawyers/login`           | POST        | âœ… Working | `LawyerLoginRequest` â†’ `LawyerLoginResponse` |
| `getMyProfile()`   | `/lawyers/me`              | GET         | âœ… Working | Returns `LawyerProfile`                      |
| `updateProfile()`  | `/lawyers/me`              | PUT         | âœ… Working | `Partial<LawyerProfile>`                     |
| `changePassword()` | `/lawyers/change-password` | POST        | âœ… Working | `{current_password, new_password}`           |
| `verifyEmail()`    | `/lawyers/verify-email`    | POST        | âœ… Working | `{token}`                                    |
| `getSessions()`    | `/lawyers/sessions`        | GET         | âœ… Working | Returns session list                         |

**Backend Routes:** `routers/lawyers.py`

---

### Lawbook System

#### Frontend Service: `services/lawbook.tsx`

| Frontend Method     | Backend Endpoint   | HTTP Method | Status     | Data Schema                      |
| ------------------- | ------------------ | ----------- | ---------- | -------------------------------- |
| `fetchLaws()`       | `/lawbook/`        | GET         | âœ… Working | Returns `{laws: Law[]}`          |
| `fetchLawContent()` | `/lawbook/{lawId}` | GET         | âœ… Working | Returns `{content: string}`      |
| `submitQuery()`     | `/lawbook/query`   | POST        | âœ… Working | `QueryRequest` â†’ `QueryResponse` |

**Backend Routes:** `routers/lawbook.py`

---

### Chat System (Session-Based)

#### Frontend Service: **MISSING** âŒ

| Frontend Method    | Backend Endpoint          | HTTP Method | Status        | Data Schema                                |
| ------------------ | ------------------------- | ----------- | ------------- | ------------------------------------------ |
| âŒ Not implemented | `/api/chat/send`          | POST        | Backend Ready | `ChatSendMessage` â†’ `ChatExchangeResponse` |
| âŒ Not implemented | `/api/chat/history`       | GET         | Backend Ready | Returns chat history                       |
| âŒ Not implemented | `/api/chat/sessions`      | GET         | Backend Ready | Returns session list                       |
| âŒ Not implemented | `/api/chat/sessions/{id}` | GET         | Backend Ready | Returns session with messages              |
| âŒ Not implemented | `/api/chat/sessions/{id}` | PATCH       | Backend Ready | Update session (rename)                    |
| âŒ Not implemented | `/api/chat/sessions/{id}` | DELETE      | Backend Ready | Delete session                             |
| âŒ Not implemented | `/api/chat/stats`         | GET         | Backend Ready | Returns chat statistics                    |

**Backend Routes:** `routers/chat.py`

**Config Endpoints Defined But Not Used:**

```typescript
CHAT: {
    SEND: '/api/chat/send',
    HISTORY: '/api/chat/history',
    SESSIONS: '/api/chat/sessions',
    SESSION: (id: string) => `/api/chat/sessions/${id}`,
    DELETE_SESSION: (id: string) => `/api/chat/sessions/${id}`,
    UPDATE_SESSION: (id: string) => `/api/chat/sessions/${id}`,
    STATS: '/api/chat/stats',
}
```

---

### Google OAuth

#### Frontend Service: `services/auth.ts`

| Frontend Method               | Backend Endpoint        | HTTP Method | Status     |
| ----------------------------- | ----------------------- | ----------- | ---------- |
| `getGoogleLoginUrl()`         | `/auth/google/login`    | GET         | âœ… Working |
| (Callback handled by backend) | `/auth/google/callback` | GET         | âœ… Working |

**Backend Routes:** `routers/google_oauth.py`

---

### Legal Queries

#### Backend Endpoint Available

| Backend Endpoint | HTTP Method | Status           | Frontend Usage          |
| ---------------- | ----------- | ---------------- | ----------------------- |
| `/legal-queries` | POST        | âœ… Backend Ready | âŒ Not used in frontend |
| `/legal-queries` | GET         | âœ… Backend Ready | âŒ Not used in frontend |

**Backend Routes:** `routers/legal_queries.py`

---

### Case Agent

#### Backend Endpoint Available

| Backend Endpoint      | HTTP Method | Status           | Frontend Usage          |
| --------------------- | ----------- | ---------------- | ----------------------- |
| `/case-agent/analyze` | POST        | âœ… Backend Ready | âŒ Not used in frontend |

**Backend Routes:** `routers/case_agent.py`

---

### Payments

#### Backend Endpoint Available

| Backend Endpoint          | HTTP Method | Status           | Frontend Usage          |
| ------------------------- | ----------- | ---------------- | ----------------------- |
| `/payments/create-order`  | POST        | âœ… Backend Ready | âŒ Not used in frontend |
| `/payments/capture-order` | POST        | âœ… Backend Ready | âŒ Not used in frontend |

**Backend Routes:** `routers/payments.py`

**Frontend Config Has:**

```typescript
PAYPAL_CLIENT_ID: ENV.PAYPAL_CLIENT_ID;
```

---

## âŒ Missing Handshake List (Tasks to Completion)

### ğŸ”´ Critical - Blocking User Flows

#### 1. **Dashboard Page - Real Data Integration**

**Location:** `frontend/src/pages/Dashboard/Dashboard.tsx`

**Problem:** Dashboard uses mock data from `useDashboardData` hook instead of fetching real incidents.

**Required Changes:**

- Create `services/dashboard.ts` with:
  ```typescript
  async function getDashboardStats(): Promise<DashboardStats>;
  async function getUserIncidents(): Promise<Incident[]>;
  ```
- Update `hooks/useDashboardData.ts` to call:
  - `GET /incidents/` - Fetch user's incidents
  - `GET /api/chat/stats` - Fetch chat statistics (if implemented)
- **Data Schema Needed:**
  ```typescript
  interface DashboardStats {
    totalIncidents: number;
    activeIncidents: number;
    resolvedIncidents: number;
    totalMessages: number;
  }
  ```

**Auth Headers:** âœ… Already implemented (Bearer token)

---

#### 2. **AI Chat Page - Complete Implementation**

**Location:** `frontend/src/pages/AIChat/AIChat.tsx`

**Problem:** Page exists but has no service layer to communicate with `/api/chat/*` endpoints.

**Required Changes:**

- Create `services/chat.ts` with methods:
  ```typescript
  async function sendChatMessage(
    message: string,
    sessionId?: string,
  ): Promise<ChatExchangeResponse>;
  async function getChatSessions(): Promise<ChatSession[]>;
  async function getChatSession(
    sessionId: string,
  ): Promise<ChatSessionWithMessages>;
  async function createChatSession(title: string): Promise<ChatSession>;
  async function updateChatSession(
    sessionId: string,
    title: string,
  ): Promise<void>;
  async function deleteChatSession(sessionId: string): Promise<void>;
  async function getChatStats(): Promise<ChatStats>;
  ```

**Data Schemas Needed:**

```typescript
interface ChatSendMessage {
  message: string;
  session_id?: string;
}

interface ChatExchangeResponse {
  user_message: ChatMessage;
  assistant_message: ChatMessage;
  session_id: string;
}

interface ChatSession {
  id: string;
  title: string;
  created_at: string;
  updated_at: string;
  message_count: number;
}

interface ChatStats {
  total_sessions: number;
  total_messages: number;
  total_user_messages: number;
  total_assistant_messages: number;
}
```

**Auth Headers:** âœ… Bearer token required

---

#### 3. **Incident Detail Page - Backend Integration**

**Location:** `frontend/src/pages/IncidentDetail/IncidentDetail.tsx`

**Problem:** Page receives incident as prop but doesn't fetch from backend or allow updates.

**Required Changes:**

- Add API call to fetch incident by ID: `GET /incidents/{id}`
- Add update functionality: `PATCH /incidents/{id}` (backend endpoint exists)
- Add delete functionality: `DELETE /incidents/{id}` (backend endpoint exists)

**Data Schema for Update:**

```typescript
interface IncidentUpdate {
  title?: string;
  description?: string;
  status?: "draft" | "submitted" | "under_review" | "resolved";
  // ... other fields
}
```

---

#### 4. **Evidence Vault Page - Complete Implementation**

**Location:** `frontend/src/pages/EvidenceVault/EvidenceVault.tsx`

**Problem:** Page is static UI only, no backend integration.

**Required Changes:**

- Fetch all evidence across all incidents: Need new backend endpoint
  - **Missing Backend:** `GET /evidence/` - Get all evidence for current user
  - Alternative: Loop through incidents and fetch evidence for each
- Display evidence with filtering/search
- Allow evidence download (need backend endpoint for file serving)

**Data Schema:**

```typescript
interface EvidenceVaultItem {
  id: number;
  incident_id: number;
  incident_title: string;
  file_name: string;
  file_type: string;
  file_size: number;
  uploaded_at: string;
}
```

**Missing Backend Endpoint:**

```python
@router.get("/evidence/all")
async def get_all_user_evidence(
    current_user: User = Depends(get_current_active_user),
    db: Session = Depends(get_db)
)
```

---

#### 5. **Settings Page - Complete Profile Management**

**Location:** `frontend/src/pages/Settings/Settings.tsx`

**Problem:** Partial implementation, needs full integration with auth endpoints.

**Required Changes:**

- Implement profile update form calling `PATCH /auth/me`
- Implement password change calling `POST /auth/change-password`
- Implement MFA management:
  - `POST /auth/mfa/setup`
  - `POST /auth/mfa/enable`
  - `POST /auth/mfa/disable`
  - `GET /auth/mfa/status`
- Implement session management:
  - `GET /auth/sessions`
  - `DELETE /auth/sessions/{id}`

**All endpoints exist, just need UI integration.**

---

### ğŸŸ¡ Medium Priority - Enhanced Features

#### 6. **Case Agent Integration**

**Backend:** `routers/case_agent.py` - `/case-agent/analyze`

**Problem:** Backend has AI case analysis endpoint but frontend doesn't use it.

**Potential Use Cases:**

- Add "Analyze Case" button in Incident Workspace
- Automatically analyze incident after creation
- Show AI-generated case summary

**Data Schema:**

```typescript
interface CaseAnalysisRequest {
  incident_id: number;
  additional_context?: string;
}

interface CaseAnalysisResponse {
  summary: string;
  identified_laws: LawViolation[];
  recommendations: string[];
  confidence_score: number;
}
```

---

#### 7. **Legal Queries System**

**Backend:** `routers/legal_queries.py` - `/legal-queries`

**Problem:** Backend has legal query storage but frontend doesn't use it.

**Potential Use Cases:**

- Save lawbook queries for later reference
- View query history
- Share queries with lawyers

**Data Schema:**

```typescript
interface LegalQueryCreate {
  question: string;
  context?: string;
}

interface LegalQueryResponse {
  id: number;
  user_id: number;
  question: string;
  answer: string;
  created_at: string;
}
```

---

#### 8. **Payment Integration**

**Backend:** `routers/payments.py` - `/payments/*`

**Problem:** PayPal integration exists in backend but not used in frontend.

**Potential Use Cases:**

- Pay for lawyer consultations
- Premium features
- Document certification fees

**Required:**

- Create `services/payments.ts`
- Add PayPal button component
- Integrate with lawyer finder or premium features

**Config Already Has:**

```typescript
PAYPAL_CLIENT_ID: ENV.PAYPAL_CLIENT_ID;
```

---

### ğŸŸ¢ Low Priority - Nice to Have

#### 9. **Lawyer Verification Admin Panel**

**Backend:** `routers/lawyer_verification.py`

**Problem:** Admin endpoints exist but no admin UI.

**Endpoints:**

- `GET /admin/lawyers/pending`
- `POST /admin/lawyers/{id}/verify`
- `POST /admin/lawyers/{id}/reject`

**Requires:**

- Admin authentication flow
- Admin dashboard page
- Lawyer verification UI

---

#### 10. **Document Storage Service**

**Backend:** `models/DocumentStorageService.py`

**Problem:** Backend has document storage model but no API endpoints.

**Potential Use:**

- Store legal documents
- Generate PDF reports
- Archive incident reports

---

## ğŸš¶ Full User Walkthrough (The Journey)

### Happy Path: New User Registration â†’ Incident Report â†’ Lawyer Consultation

#### 1. **User Registration & Email Verification**

```
User lands on â†’ / (redirects to Auth page)
â”œâ”€ User clicks "Sign Up"
â”œâ”€ Fills registration form
â”œâ”€ Frontend calls â†’ POST /auth/register
â”‚  â””â”€ Backend creates user, sends verification email
â”œâ”€ User receives email with token
â”œâ”€ User clicks link â†’ /verify-email?token=xxx
â”œâ”€ Frontend calls â†’ POST /auth/verify-email
â”‚  â””â”€ Backend marks email as verified
â””â”€ User redirected to â†’ /dashboard
```

**Data Flow:**

```typescript
RegisterRequest {
  email: string,
  password: string,
  full_name: string
}
â†’ Backend validates, creates user
â†’ Returns RegistrationResponse {
  message: "Registration successful",
  user_id: number
}
```

**Error Handling:**

- If email exists: Backend returns `400` with `{detail: "Email already registered"}`
- Frontend shows toast notification
- If verification fails: Backend returns `400` with `{detail: "Invalid or expired token"}`

---

#### 2. **User Login**

```
User lands on â†’ / (Auth page)
â”œâ”€ User enters credentials
â”œâ”€ Frontend calls â†’ POST /auth/login
â”‚  â””â”€ Backend validates credentials, generates JWT
â”œâ”€ Frontend stores tokens in localStorage
â”œâ”€ Frontend calls â†’ GET /auth/me
â”‚  â””â”€ Backend returns user profile
â””â”€ User redirected to â†’ /dashboard
```

**Data Flow:**

```typescript
LoginRequest { email, password }
â†’ Backend validates
â†’ Returns LoginResponse {
  access_token: string,
  refresh_token: string,
  token_type: "bearer",
  user_id: number,
  email: string,
  full_name: string
}
```

**Error Handling:**

- If credentials invalid: Backend returns `401` with `{detail: "Invalid credentials"}`
- If email not verified: Backend returns `403` with `{detail: "Email not verified"}`
- Frontend shows error toast

---

#### 3. **Dashboard - First View**

```
User lands on â†’ /dashboard
â”œâ”€ Frontend calls â†’ GET /incidents/ (with Bearer token)
â”‚  â””â”€ Backend returns empty array (new user)
â”œâ”€ Dashboard shows "New User" view with CTA
â”œâ”€ Mock stats displayed (needs real data integration)
â””â”€ User clicks "Report New Incident"
   â””â”€ Navigates to â†’ /new-incident
```

**Current Issue:** âš ï¸ Dashboard uses mock data, needs real API integration

---

#### 4. **Create Incident Report**

```
User on â†’ /new-incident
â”œâ”€ Wizard Step 1: Incident Type
â”‚  â””â”€ User selects type (cyberbullying, harassment, etc.)
â”œâ”€ Wizard Step 2: Basic Information
â”‚  â””â”€ User enters title, description, date, location
â”œâ”€ Wizard Step 3: Additional Details
â”‚  â””â”€ User enters platforms, perpetrator info
â”œâ”€ User clicks "Complete"
â”œâ”€ Frontend calls â†’ POST /incidents/
â”‚  â””â”€ Backend creates incident, returns incident_id
â””â”€ User redirected to â†’ /incident-workspace
```

**Data Flow:**

```typescript
IncidentCreate {
  incident_type: 'cyberbullying',
  title: 'Harassment on social media',
  description: 'Detailed description...',
  date_occurred: '2026-02-08',
  location: 'Colombo, Sri Lanka',
  jurisdiction: 'Sri Lanka',
  platforms_involved: 'Facebook, Instagram',
  perpetrator_info: 'Username: @harasser123'
}
â†’ Backend creates incident
â†’ Returns IncidentResponse {
  id: 123,
  user_id: 456,
  status: 'submitted',
  created_at: '2026-02-08T18:53:15Z',
  ...
}
```

**Error Handling:**

- If unauthorized: Backend returns `401`, frontend redirects to login
- If validation fails: Backend returns `422` with field errors
- Frontend shows validation errors inline

---

#### 5. **Incident Workspace - AI Analysis & Evidence Upload**

```
User on â†’ /incident-workspace
â”œâ”€ Incident created (ID stored in state)
â”œâ”€ AI Analysis starts automatically (mock, 2-second delay)
â”œâ”€ Timeline shows "Incident Reported" event
â”œâ”€ After analysis:
â”‚  â”œâ”€ Timeline shows "AI Analysis Complete"
â”‚  â””â”€ Identified laws displayed (mock data)
â”œâ”€ User uploads evidence:
â”‚  â”œâ”€ Selects files
â”‚  â”œâ”€ Frontend calls â†’ POST /incidents/{id}/evidence
â”‚  â”‚  â””â”€ Backend saves files, returns evidence metadata
â”‚  â””â”€ Timeline updated with "Evidence Uploaded" event
â”œâ”€ User chats with AI:
â”‚  â”œâ”€ Types message
â”‚  â”œâ”€ Frontend calls â†’ POST /incidents/{id}/messages
â”‚  â”‚  â””â”€ Backend processes with AI, returns response
â”‚  â””â”€ Chat UI updates with both messages
â””â”€ User clicks "Submit to Police"
   â””â”€ Incident status updated (currently local only)
```

**Data Flow - Evidence Upload:**

```typescript
FormData with files
â†’ POST /incidents/123/evidence
â†’ Backend saves to uploaded_evidence/
â†’ Returns EvidenceResponse[] {
  id: 789,
  incident_id: 123,
  file_name: 'screenshot.png',
  file_path: 'uploaded_evidence/xxx.png',
  file_type: 'image/png',
  file_size: 245678,
  uploaded_at: '2026-02-08T19:00:00Z'
}
```

**Data Flow - AI Chat:**

```typescript
{ content: 'What laws apply to my case?' }
â†’ POST /incidents/123/messages
â†’ Backend:
  1. Saves user message
  2. Calls AI chain with incident context
  3. Saves AI response
â†’ Returns IncidentChatExchangeResponse {
  user_message: { id, role: 'user', content, created_at },
  assistant_message: { id, role: 'assistant', content, created_at }
}
```

**Error Handling:**

- If file too large: Backend returns `413` with `{detail: "File too large"}`
- If AI fails: Backend returns `500`, frontend shows fallback message
- If unauthorized: Backend returns `401`, frontend redirects to login

---

#### 6. **Find Lawyer**

```
User clicks "Find Lawyers" from workspace
â”œâ”€ Navigates to â†’ /lawyers
â”œâ”€ Frontend calls â†’ GET /lawyers/?specialty=cyber-crime
â”‚  â””â”€ Backend returns filtered lawyer list
â”œâ”€ User views lawyer profiles
â”œâ”€ User clicks "Contact" (future: payment integration)
â””â”€ User can filter by district, specialty
```

**Data Flow:**

```typescript
GET /lawyers/?specialty=cyber-crime&district=Colombo
â†’ Backend queries database
â†’ Returns Lawyer[] {
  id, name, specialties, rating, reviews_count,
  availability, experience_years, email, phone,
  district, verification_status, is_active
}
```

---

#### 7. **Lawbook Research**

```
User navigates to â†’ /lawbook
â”œâ”€ Frontend calls â†’ GET /lawbook/
â”‚  â””â”€ Backend returns list of available laws
â”œâ”€ User selects a law
â”œâ”€ Frontend calls â†’ GET /lawbook/{lawId}
â”‚  â””â”€ Backend returns law content (markdown)
â”œâ”€ User submits query
â”œâ”€ Frontend calls â†’ POST /lawbook/query
â”‚  â””â”€ Backend processes with AI, returns analysis
â””â”€ User views citations and legal analysis
```

**Data Flow - Query:**

```typescript
QueryRequest {
  question: 'What is the penalty for cyberbullying?',
  case_context: 'My incident details...'
}
â†’ POST /lawbook/query
â†’ Backend:
  1. Retrieves relevant laws from vector DB
  2. Processes with AI reasoning chain
  3. Validates with legal validator
â†’ Returns QueryResponse {
  status: 'success',
  data: {
    response: 'Based on the Computer Crimes Act...',
    confidence_note: 'High confidence (92%)',
    disclaimer: 'This is not legal advice...',
    metadata: { retrieval_timestamp, sources_count, ... },
    citations: [{ law_name, section, text }, ...]
  },
  session_id: 'uuid',
  timestamp: '2026-02-08T19:30:00Z'
}
```

---

#### 8. **Session Management & Logout**

```
User clicks profile â†’ Settings
â”œâ”€ Frontend calls â†’ GET /auth/sessions
â”‚  â””â”€ Backend returns active sessions
â”œâ”€ User views sessions (device, IP, last activity)
â”œâ”€ User revokes a session
â”œâ”€ Frontend calls â†’ DELETE /auth/sessions/{id}
â”‚  â””â”€ Backend invalidates session
â””â”€ User clicks "Logout"
   â”œâ”€ Frontend calls â†’ POST /auth/logout
   â”‚  â””â”€ Backend blacklists token
   â”œâ”€ Frontend clears localStorage
   â””â”€ User redirected to â†’ / (Auth page)
```

---

### Error Scenarios

#### Scenario 1: Token Expiration During Session

```
User performs action â†’ Frontend calls API with expired token
â”œâ”€ Backend returns â†’ 401 Unauthorized
â”œâ”€ Frontend intercepts error
â”œâ”€ Frontend calls â†’ POST /auth/refresh
â”‚  â””â”€ Backend validates refresh token, returns new access token
â”œâ”€ Frontend retries original request with new token
â””â”€ If refresh fails:
   â”œâ”€ Frontend clears tokens
   â””â”€ Redirects to login page
```

**Current Issue:** âš ï¸ Token refresh logic needs implementation in frontend

---

#### Scenario 2: Network Failure

```
User submits form â†’ Frontend calls API
â”œâ”€ Network error (timeout, no connection)
â”œâ”€ Frontend catches error
â”œâ”€ Shows toast: "Network error. Please try again."
â””â”€ User can retry action
```

---

#### Scenario 3: Validation Error

```
User submits incident with missing required field
â”œâ”€ Frontend calls â†’ POST /incidents/
â”œâ”€ Backend returns â†’ 422 Unprocessable Entity
â”‚  â””â”€ { detail: [{ loc: ['body', 'title'], msg: 'field required' }] }
â”œâ”€ Frontend parses validation errors
â””â”€ Shows inline error messages on form fields
```

---

## âœ… Final Completion Checklist

### ğŸ” Authentication (95% Complete)

- [x] User registration
- [x] Email verification
- [x] Login/Logout
- [x] JWT token management
- [x] Google OAuth integration
- [x] Password reset flow
- [x] MFA setup & enable
- [ ] **Token auto-refresh on expiration** (needs implementation)
- [ ] **Session timeout warning** (nice to have)

---

### ğŸ“‹ Incident Management (85% Complete)

- [x] Create incident via wizard
- [x] Incident creation API integration
- [x] Evidence upload
- [x] Incident chat with AI
- [x] Chat message persistence
- [x] Evidence listing
- [x] Evidence deletion
- [ ] **Fetch incidents on Dashboard** (critical)
- [ ] **Update incident details** (backend ready, frontend missing)
- [ ] **Delete incident** (backend ready, frontend missing)
- [ ] **Incident status workflow** (draft â†’ submitted â†’ under_review â†’ resolved)
- [ ] **Download evidence files** (needs backend endpoint)

---

### ğŸ’¬ Chat System (30% Complete)

- [x] Incident-specific chat (working)
- [ ] **General AI chat page** (UI exists, no backend integration)
- [ ] **Chat session management** (backend ready, frontend missing)
- [ ] **Chat history sidebar** (backend ready, frontend missing)
- [ ] **Session rename** (backend ready, frontend missing)
- [ ] **Session deletion** (backend ready, frontend missing)
- [ ] **Chat statistics** (backend ready, frontend missing)

---

### âš–ï¸ Lawyer System (90% Complete)

- [x] Lawyer search & filter
- [x] Lawyer registration
- [x] Lawyer login
- [x] Lawyer profile management
- [x] Email verification for lawyers
- [x] Session management for lawyers
- [ ] **Lawyer-client messaging** (not implemented)
- [ ] **Lawyer booking system** (not implemented)
- [ ] **Payment integration** (backend ready, frontend missing)

---

### ğŸ“š Lawbook System (100% Complete)

- [x] List available laws
- [x] View law content
- [x] Submit legal queries
- [x] AI-powered legal analysis
- [x] Citations & references
- [x] Confidence scoring
- [x] Legal disclaimers

---

### ğŸ“Š Dashboard & Analytics (40% Complete)

- [x] Dashboard UI
- [x] Stats grid component
- [x] Activity feed component
- [ ] **Real incident data fetching** (critical)
- [ ] **Real statistics** (currently mock data)
- [ ] **Chart data from backend** (currently mock)
- [ ] **Recent activity from backend** (currently mock)

---

### ğŸ”§ Settings & Profile (60% Complete)

- [x] View profile
- [x] Update profile API
- [ ] **Profile update UI** (needs full implementation)
- [ ] **Password change UI** (needs implementation)
- [ ] **MFA management UI** (backend ready, UI missing)
- [ ] **Session management UI** (backend ready, UI missing)
- [ ] **Notification preferences** (not implemented)

---

### ğŸ—„ï¸ Evidence Vault (10% Complete)

- [x] Evidence vault page UI
- [ ] **Fetch all user evidence** (needs backend endpoint)
- [ ] **Evidence filtering** (needs implementation)
- [ ] **Evidence search** (needs implementation)
- [ ] **Evidence download** (needs backend endpoint)
- [ ] **Evidence preview** (needs implementation)

---

### ğŸ¤– Advanced AI Features (20% Complete)

- [x] Incident chat AI
- [x] Lawbook query AI
- [ ] **Case agent analysis** (backend ready, frontend missing)
- [ ] **Automatic law identification** (currently mock)
- [ ] **Evidence analysis** (not implemented)
- [ ] **Timeline auto-generation** (partially mock)

---

### ğŸ’³ Payment System (0% Complete)

- [ ] **PayPal integration** (backend ready, frontend missing)
- [ ] **Create payment order** (backend ready)
- [ ] **Capture payment** (backend ready)
- [ ] **Payment history** (not implemented)
- [ ] **Lawyer consultation payments** (not implemented)

---

### ğŸ›¡ï¸ Admin Features (0% Complete)

- [ ] **Admin login** (backend ready)
- [ ] **Lawyer verification UI** (backend ready)
- [ ] **Admin dashboard** (not implemented)
- [ ] **User management** (not implemented)
- [ ] **System analytics** (not implemented)

---

## ğŸ“ Priority Implementation Order

### Phase 1: Critical Fixes (Week 1)

1. âœ… **Dashboard real data integration** - Fetch incidents from `/incidents/`
2. âœ… **Token auto-refresh** - Implement refresh logic in auth service
3. âœ… **Incident detail page** - Add fetch, update, delete functionality

### Phase 2: Core Features (Week 2)

4. âœ… **AI Chat page** - Complete session-based chat implementation
5. âœ… **Settings page** - Full profile, password, MFA, session management
6. âœ… **Evidence vault** - Backend endpoint + frontend integration

### Phase 3: Enhanced Features (Week 3)

7. âœ… **Case agent integration** - Add analyze button in workspace
8. âœ… **Legal queries** - Save and view query history
9. âœ… **Payment integration** - PayPal for lawyer consultations

### Phase 4: Admin & Polish (Week 4)

10. âœ… **Admin panel** - Lawyer verification UI
11. âœ… **Error handling** - Comprehensive error boundaries
12. âœ… **Loading states** - Better UX for async operations
13. âœ… **Testing** - Unit and integration tests

---

## ğŸ”‘ Environment Variables Checklist

### Frontend (.env)

```bash
VITE_API_URL=http://127.0.0.1:8000
VITE_FRONTEND_URL=http://localhost:5173
VITE_ENABLE_GOOGLE_AUTH=true
VITE_PAYPAL_CLIENT_ID=your_paypal_client_id
```

### Backend (.env)

```bash
SECRET_KEY=your-secret-key-min-32-chars
DATABASE_URL=postgresql://user:pass@localhost/sentilex_db
GOOGLE_CLIENT_ID=your_google_client_id
GOOGLE_CLIENT_SECRET=your_google_client_secret
OPENAI_API_KEY=your_openai_key
PAYPAL_CLIENT_ID=your_paypal_client_id
PAYPAL_CLIENT_SECRET=your_paypal_secret
```

---

## ğŸ¯ Success Metrics

### Current Completion Status

- **Authentication:** 95% âœ…
- **Incident Management:** 85% âš ï¸
- **Lawyer System:** 90% âœ…
- **Lawbook:** 100% âœ…
- **Chat System:** 30% âŒ
- **Dashboard:** 40% âŒ
- **Evidence Vault:** 10% âŒ
- **Payments:** 0% âŒ
- **Admin:** 0% âŒ

### Overall Project Completion: **~60%**

---

## ğŸ“ Next Steps

1. **Review this document** with the team
2. **Prioritize missing features** based on business needs
3. **Assign tasks** from the completion checklist
4. **Create backend endpoints** for missing functionality (Evidence Vault, etc.)
5. **Implement frontend services** for existing backend endpoints (Chat, Case Agent, etc.)
6. **Add comprehensive error handling** and loading states
7. **Write tests** for critical user flows
8. **Deploy to staging** for user testing

---

**Document maintained by:** Development Team  
**Last audit:** 2026-02-08  
**Next review:** After Phase 1 completion
